{"ast":null,"code":"import _initializerDefineProperty from \"/home/ib_admin/Practice/iB-Assignments/assignment-10/Mobx-Shopping-Site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _applyDecoratedDescriptor from \"/home/ib_admin/Practice/iB-Assignments/assignment-10/Mobx-Shopping-Site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"/home/ib_admin/Practice/iB-Assignments/assignment-10/Mobx-Shopping-Site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper\";\n\nvar _class, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _descriptor16, _temp;\n\nimport { observer } from \"mobx-react\";\nimport { action, computed, observable } from \"mobx\";\nimport CartItem from \"../models/CartItem\";\nimport Product from \"../models/Product\";\nimport User from \"../models/User\";\nimport { endpoints, loadingStatus } from \"../constants\";\nlet Products = (_class = (_temp = class Products {\n  constructor() {\n    _initializerDefineProperty(this, \"cart\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"products\", _descriptor2, this);\n\n    _initializerDefineProperty(this, \"sizes\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"orderBy\", _descriptor4, this);\n\n    _initializerDefineProperty(this, \"loadingStatus\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"loginStatus\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"signUpStatus\", _descriptor7, this);\n\n    _initializerDefineProperty(this, \"msg\", _descriptor8, this);\n\n    _initializerDefineProperty(this, \"addToCart\", _descriptor9, this);\n\n    _initializerDefineProperty(this, \"removeFromCart\", _descriptor10, this);\n\n    _initializerDefineProperty(this, \"signUp\", _descriptor11, this);\n\n    _initializerDefineProperty(this, \"login\", _descriptor12, this);\n\n    _initializerDefineProperty(this, \"fetchData\", _descriptor13, this);\n\n    _initializerDefineProperty(this, \"addProduct\", _descriptor14, this);\n\n    _initializerDefineProperty(this, \"updateSizeFilters\", _descriptor15, this);\n\n    _initializerDefineProperty(this, \"updateOrderBy\", _descriptor16, this);\n\n    this.getProduct = id => {\n      return this.products[this.getIndexInProducts(id)];\n    };\n\n    this.getIndexInProducts = id => {\n      return this.products.findIndex(product => {\n        return product.id === id;\n      });\n    };\n  }\n\n  get cartItemsCount() {\n    if (this.cart.length === 0) {\n      return 0;\n    }\n\n    return this.cart.reduce((accumulator, currentValue) => {\n      return accumulator + currentValue.quantity;\n    }, 0);\n  }\n\n  get filteredProducts() {\n    let allProducts = this.products;\n\n    if (!this.sizes.length && this.orderBy === \"\") {\n      return allProducts;\n    }\n\n    console.log(this.orderBy);\n\n    if (this.orderBy === \"lh\") {\n      console.log(\"in lh\");\n      allProducts = allProducts.sort((a, b) => {\n        return a.price - b.price;\n      });\n    }\n\n    if (this.orderBy === \"hl\") {\n      console.log(\"in h1\");\n      allProducts = allProducts.sort((a, b) => {\n        return b.price - a.price;\n      });\n    }\n\n    if (this.sizes.length) {\n      console.log(\"in filter upon\");\n      allProducts = allProducts.filter(product => {\n        // TODO: try to eliminate for\n        for (let i = 0; i < this.sizes.length; i++) {\n          if (product.availableSizes.includes(this.sizes[i])) {\n            return true;\n          }\n        }\n\n        return false;\n      });\n    }\n\n    return allProducts;\n  }\n\n  get filteredProductsCount() {\n    return this.filteredProducts.length;\n  }\n\n  get totalCartValue() {\n    if (this.cart.length === 0) {\n      return \"0.00\";\n    }\n\n    return this.cart.reduce((accumulator, currentValue) => {\n      return accumulator + currentValue.quantity * this.products[this.getIndexInProducts(currentValue.itemId)].price;\n    }, 0).toFixed(2);\n  }\n\n}, _temp), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"cart\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return [];\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"products\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return [];\n  }\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"sizes\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return [];\n  }\n}), _descriptor4 = _applyDecoratedDescriptor(_class.prototype, \"orderBy\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return \"\";\n  }\n}), _descriptor5 = _applyDecoratedDescriptor(_class.prototype, \"loadingStatus\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return loadingStatus.loading;\n  }\n}), _descriptor6 = _applyDecoratedDescriptor(_class.prototype, \"loginStatus\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return {};\n  }\n}), _descriptor7 = _applyDecoratedDescriptor(_class.prototype, \"signUpStatus\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return {\n      status: \"\"\n    };\n  }\n}), _descriptor8 = _applyDecoratedDescriptor(_class.prototype, \"msg\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return \"\";\n  }\n}), _descriptor9 = _applyDecoratedDescriptor(_class.prototype, \"addToCart\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return (id, size) => {\n      if (this.cart.some((item, itemIndex) => {\n        if (item.itemId === id && item.size === size) {\n          item.increaseQty();\n          return true;\n        }\n\n        return false;\n      })) {\n        return;\n      } else {\n        console.log(\"in else push new item\");\n        this.cart.push(new CartItem(id, size));\n      }\n    };\n  }\n}), _descriptor10 = _applyDecoratedDescriptor(_class.prototype, \"removeFromCart\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return item => {\n      this.cart.forEach((cartItem, index) => {\n        if (cartItem === item) {\n          this.cart.splice(index, 1);\n        }\n      });\n    };\n  }\n}), _descriptor11 = _applyDecoratedDescriptor(_class.prototype, \"signUp\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return (username, password, history) => {\n      let user = new User(username, password);\n      const options = {\n        method: \"POST\",\n        body: JSON.stringify(user),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      fetch(endpoints.signup, options).then(res => res.json()).then(res => {\n        this.signUpStatus = res;\n\n        if (this.signUpStatus.error) {\n          this.msg = this.signUpStatus.error;\n          console.log(this.msg);\n          return;\n        }\n\n        this.msg = \"user created successfully. please login\";\n      }).catch(err => {\n        console.log(\"Ooops, error\", err.message);\n      });\n    };\n  }\n}), _descriptor12 = _applyDecoratedDescriptor(_class.prototype, \"login\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return (username, password, history) => {\n      let user = new User(username, password);\n      const options = {\n        method: \"POST\",\n        body: JSON.stringify(user),\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      fetch(endpoints.login, options).then(res => res.json()).then(res => {\n        this.loginStatus = res;\n      }).then(res => {\n        if (this.loginStatus.error) {\n          this.msg = this.loginStatus.error;\n          console.log(this.msg);\n          return;\n        }\n\n        history.replace(\"/products\");\n      }).catch(err => {\n        console.log(\"Ooops, error\", err.message);\n      });\n    };\n  }\n}), _descriptor13 = _applyDecoratedDescriptor(_class.prototype, \"fetchData\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return () => {\n      const options = {\n        method: \"POST\",\n        headers: {\n          Authorization: this.loginStatus.accessToken,\n          \"Content-Type\": \"application/json\"\n        }\n      };\n      fetch(endpoints.products, options).then(result => {\n        if (result.ok) {\n          return result.json();\n        } else {\n          this.loadingStatus = loadingStatus.fail;\n        }\n      }).then(json => {\n        json.products.forEach(product => {\n          this.addProduct(product);\n        });\n        this.loadingStatus = loadingStatus.success;\n      }).catch(err => {\n        console.log(\"Ooops, error\", err.message);\n        this.loadingStatus = loadingStatus.fail;\n      });\n    };\n  }\n}), _descriptor14 = _applyDecoratedDescriptor(_class.prototype, \"addProduct\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return obj => {\n      this.products.push(new Product(obj));\n    };\n  }\n}), _descriptor15 = _applyDecoratedDescriptor(_class.prototype, \"updateSizeFilters\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return size => {\n      if (this.sizes.includes(size)) {\n        this.sizes.splice(this.sizes.indexOf(size), 1);\n        return;\n      }\n\n      this.sizes.push(size);\n    };\n  }\n}), _descriptor16 = _applyDecoratedDescriptor(_class.prototype, \"updateOrderBy\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function () {\n    return order => {\n      this.orderBy = order;\n    };\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"cartItemsCount\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"cartItemsCount\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"filteredProducts\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"filteredProducts\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"filteredProductsCount\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"filteredProductsCount\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"totalCartValue\", [computed], Object.getOwnPropertyDescriptor(_class.prototype, \"totalCartValue\"), _class.prototype)), _class);\nexport default Products;","map":{"version":3,"sources":["/home/ib_admin/Practice/iB-Assignments/assignment-10/Mobx-Shopping-Site/src/Store/index.js"],"names":["observer","action","computed","observable","CartItem","Product","User","endpoints","loadingStatus","Products","getProduct","id","products","getIndexInProducts","findIndex","product","cartItemsCount","cart","length","reduce","accumulator","currentValue","quantity","filteredProducts","allProducts","sizes","orderBy","console","log","sort","a","b","price","filter","i","availableSizes","includes","filteredProductsCount","totalCartValue","itemId","toFixed","loading","status","size","some","item","itemIndex","increaseQty","push","forEach","cartItem","index","splice","username","password","history","user","options","method","body","JSON","stringify","headers","fetch","signup","then","res","json","signUpStatus","error","msg","catch","err","message","login","loginStatus","replace","Authorization","accessToken","result","ok","fail","addProduct","success","obj","indexOf","order"],"mappings":"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","sourcesContent":["import { observer } from \"mobx-react\";\nimport { action, computed, observable } from \"mobx\";\n\nimport CartItem from \"../models/CartItem\";\nimport Product from \"../models/Product\";\nimport User from \"../models/User\";\nimport { endpoints, loadingStatus } from \"../constants\";\n\nclass Products {\n  @observable cart = [];\n  @observable products = [];\n  @observable sizes = [];\n  @observable orderBy = \"\";\n  @observable loadingStatus = loadingStatus.loading;\n  @observable loginStatus = {};\n  @observable signUpStatus = { status: \"\" };\n  @observable msg = \"\";\n\n  @action addToCart = (id, size) => {\n    if (\n      this.cart.some((item, itemIndex) => {\n        if (item.itemId === id && item.size === size) {\n          item.increaseQty();\n          return true;\n        }\n        return false;\n      })\n    ) {\n      return;\n    } else {\n      console.log(\"in else push new item\");\n      this.cart.push(new CartItem(id, size));\n    }\n  };\n\n  @action removeFromCart = item => {\n    this.cart.forEach((cartItem, index) => {\n      if (cartItem === item) {\n        this.cart.splice(index, 1);\n      }\n    });\n  };\n\n  @action signUp = (username, password, history) => {\n    let user = new User(username, password);\n    const options = {\n      method: \"POST\",\n      body: JSON.stringify(user),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    fetch(endpoints.signup, options)\n      .then(res => res.json())\n      .then(res => {\n        this.signUpStatus = res;\n        if (this.signUpStatus.error) {\n          this.msg = this.signUpStatus.error;\n          console.log(this.msg);\n          return;\n        }\n        this.msg = \"user created successfully. please login\";\n      })\n      .catch(err => {\n        console.log(\"Ooops, error\", err.message);\n      });\n  };\n\n  @action login = (username, password, history) => {\n    let user = new User(username, password);\n    const options = {\n      method: \"POST\",\n      body: JSON.stringify(user),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    fetch(endpoints.login, options)\n      .then(res => res.json())\n      .then(res => {\n        this.loginStatus = res;\n      })\n      .then(res => {\n        if (this.loginStatus.error) {\n          this.msg = this.loginStatus.error;\n          console.log(this.msg);\n          return;\n        }\n        history.replace(\"/products\");\n      })\n      .catch(err => {\n        console.log(\"Ooops, error\", err.message);\n      });\n  };\n\n  @action fetchData = () => {\n    const options = {\n      method: \"POST\",\n      headers: {\n        Authorization: this.loginStatus.accessToken,\n        \"Content-Type\": \"application/json\"\n      }\n    };\n    fetch(endpoints.products, options)\n      .then(result => {\n        if (result.ok) {\n          return result.json();\n        } else {\n          this.loadingStatus = loadingStatus.fail;\n        }\n      })\n      .then(json => {\n        json.products.forEach(product => {\n          this.addProduct(product);\n        });\n        this.loadingStatus = loadingStatus.success;\n      })\n      .catch(err => {\n        console.log(\"Ooops, error\", err.message);\n        this.loadingStatus = loadingStatus.fail;\n      });\n  };\n\n  @action addProduct = obj => {\n    this.products.push(new Product(obj));\n  };\n  //TODO: make constants for sizes, orderby\n  @action updateSizeFilters = size => {\n    if (this.sizes.includes(size)) {\n      this.sizes.splice(this.sizes.indexOf(size), 1);\n      return;\n    }\n    this.sizes.push(size);\n  };\n\n  @action updateOrderBy = order => {\n    this.orderBy = order;\n  };\n\n  @computed get cartItemsCount() {\n    if (this.cart.length === 0) {\n      return 0;\n    }\n    return this.cart.reduce((accumulator, currentValue) => {\n      return accumulator + currentValue.quantity;\n    }, 0);\n  }\n\n  @computed get filteredProducts() {\n    let allProducts = this.products;\n    if (!this.sizes.length && this.orderBy === \"\") {\n      return allProducts;\n    }\n    console.log(this.orderBy);\n    if (this.orderBy === \"lh\") {\n      console.log(\"in lh\");\n      allProducts = allProducts.sort((a, b) => {\n        return a.price - b.price;\n      });\n    }\n    if (this.orderBy === \"hl\") {\n      console.log(\"in h1\");\n      allProducts = allProducts.sort((a, b) => {\n        return b.price - a.price;\n      });\n    }\n    if (this.sizes.length) {\n      console.log(\"in filter upon\");\n      allProducts = allProducts.filter(product => {\n        // TODO: try to eliminate for\n        for (let i = 0; i < this.sizes.length; i++) {\n          if (product.availableSizes.includes(this.sizes[i])) {\n            return true;\n          }\n        }\n        return false;\n      });\n    }\n    return allProducts;\n  }\n\n  @computed get filteredProductsCount() {\n    return this.filteredProducts.length;\n  }\n\n  @computed get totalCartValue() {\n    if (this.cart.length === 0) {\n      return \"0.00\";\n    }\n    return this.cart\n      .reduce((accumulator, currentValue) => {\n        return (\n          accumulator +\n          currentValue.quantity *\n            this.products[this.getIndexInProducts(currentValue.itemId)].price\n        );\n      }, 0)\n      .toFixed(2);\n  }\n\n  getProduct = id => {\n    return this.products[this.getIndexInProducts(id)];\n  };\n\n  getIndexInProducts = id => {\n    return this.products.findIndex(product => {\n      return product.id === id;\n    });\n  };\n}\n\nexport default Products;\n"]},"metadata":{},"sourceType":"module"}